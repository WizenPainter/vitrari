<!doctype html>
<html lang="en">
    <head>
        <meta charset="UTF-8" />
        <meta name="viewport" content="width=device-width, initial-scale=1.0" />
        <title>Environment Detection Test</title>
        <style>
            body {
                font-family: Arial, sans-serif;
                margin: 20px;
                background: #f5f5f5;
            }
            .test-container {
                max-width: 800px;
                margin: 0 auto;
                background: white;
                padding: 20px;
                border-radius: 8px;
                box-shadow: 0 2px 10px rgba(0, 0, 0, 0.1);
            }
            .test-section {
                margin-bottom: 30px;
                padding: 15px;
                border: 1px solid #ddd;
                border-radius: 4px;
            }
            .test-section h3 {
                margin-top: 0;
                color: #333;
            }
            .test-buttons {
                display: flex;
                gap: 10px;
                flex-wrap: wrap;
                margin: 15px 0;
            }
            .btn {
                padding: 8px 16px;
                border: 1px solid #ddd;
                border-radius: 4px;
                background: white;
                cursor: pointer;
                transition: all 0.2s;
            }
            .btn:hover {
                background: #f0f0f0;
            }
            .btn-primary {
                background: #007bff;
                color: white;
                border-color: #007bff;
            }
            .btn-outline {
                border-color: #007bff;
                color: #007bff;
            }
            .production-only {
                background: #28a745;
                color: white;
                border-color: #28a745;
            }
            .desktop-only {
                background: #6c757d;
                color: white;
                border-color: #6c757d;
            }
            .status {
                padding: 10px;
                border-radius: 4px;
                margin: 10px 0;
            }
            .status.development {
                background: #fff3cd;
                border: 1px solid #ffeaa7;
                color: #856404;
            }
            .status.production {
                background: #d1ecf1;
                border: 1px solid #bee5eb;
                color: #0c5460;
            }
            .status.mobile {
                background: #f8d7da;
                border: 1px solid #f5c6cb;
                color: #721c24;
            }
            .status.desktop {
                background: #d4edda;
                border: 1px solid #c3e6cb;
                color: #155724;
            }
            .hidden {
                display: none !important;
            }
            .info-grid {
                display: grid;
                grid-template-columns: 1fr 1fr;
                gap: 15px;
                margin: 15px 0;
            }
            .info-item {
                padding: 10px;
                background: #f8f9fa;
                border-radius: 4px;
                border-left: 4px solid #007bff;
            }
            .info-label {
                font-weight: bold;
                color: #495057;
                font-size: 14px;
            }
            .info-value {
                font-size: 16px;
                color: #212529;
                margin-top: 5px;
            }

            /* Mobile styles */
            @media (max-width: 768px) {
                .desktop-only {
                    display: none !important;
                }
                .info-grid {
                    grid-template-columns: 1fr;
                }
                .test-buttons {
                    flex-direction: column;
                }
                .btn {
                    width: 100%;
                    text-align: center;
                }
            }
        </style>
    </head>
    <body>
        <div class="test-container">
            <h1>Environment Detection Test</h1>
            <p>
                This page tests the environment detection and mobile view
                functionality implemented in the Vitrari designer.
            </p>

            <div class="test-section">
                <h3>Environment Detection</h3>
                <div id="environment-status" class="status"></div>
                <div class="info-grid">
                    <div class="info-item">
                        <div class="info-label">Hostname</div>
                        <div class="info-value" id="hostname"></div>
                    </div>
                    <div class="info-item">
                        <div class="info-label">Port</div>
                        <div class="info-value" id="port"></div>
                    </div>
                    <div class="info-item">
                        <div class="info-label">Environment</div>
                        <div class="info-value" id="environment"></div>
                    </div>
                    <div class="info-item">
                        <div class="info-label">Production Detection</div>
                        <div class="info-value" id="is-production"></div>
                    </div>
                </div>
            </div>

            <div class="test-section">
                <h3>Mobile/Desktop Detection</h3>
                <div id="viewport-status" class="status"></div>
                <div class="info-grid">
                    <div class="info-item">
                        <div class="info-label">Window Width</div>
                        <div class="info-value" id="window-width"></div>
                    </div>
                    <div class="info-item">
                        <div class="info-label">Window Height</div>
                        <div class="info-value" id="window-height"></div>
                    </div>
                    <div class="info-item">
                        <div class="info-label">Device Type</div>
                        <div class="info-value" id="device-type"></div>
                    </div>
                    <div class="info-item">
                        <div class="info-label">Is Mobile View</div>
                        <div class="info-value" id="is-mobile"></div>
                    </div>
                </div>
            </div>

            <div class="test-section">
                <h3>Button Visibility Test</h3>
                <p>
                    These buttons simulate the designer toolbar buttons.
                    Production-only buttons should be hidden in development, and
                    desktop-only buttons should be hidden on mobile.
                </p>

                <div class="test-buttons">
                    <button class="btn btn-primary" data-i18n="save">
                        Save
                    </button>
                    <button class="btn btn-outline" data-i18n="saveAs">
                        Save As
                    </button>
                    <button
                        class="btn production-only desktop-only"
                        data-i18n="saveDesign"
                    >
                        Export to File
                    </button>
                    <button
                        class="btn production-only desktop-only"
                        data-i18n="loadDesign"
                    >
                        Load Design
                    </button>
                    <button class="btn" data-i18n="printDesign">
                        Print Design
                    </button>
                    <button class="btn" data-i18n="clearAll">Clear All</button>
                </div>

                <div id="button-status"></div>
            </div>

            <div class="test-section">
                <h3>Translation Test</h3>
                <p>Switch between English and Spanish to test translations:</p>
                <div style="margin: 15px 0">
                    <button class="btn" onclick="setLanguage('en')">
                        English
                    </button>
                    <button class="btn" onclick="setLanguage('es')">
                        Español
                    </button>
                </div>
                <div>
                    <strong>Current Language:</strong>
                    <span id="current-language"></span>
                </div>
            </div>

            <div class="test-section">
                <h3>Manual Tests</h3>
                <div class="test-buttons">
                    <button class="btn" onclick="refreshTests()">
                        Refresh All Tests
                    </button>
                    <button class="btn" onclick="simulateResize(400, 600)">
                        Simulate Mobile
                    </button>
                    <button class="btn" onclick="simulateResize(1200, 800)">
                        Simulate Desktop
                    </button>
                    <button class="btn" onclick="toggleDevMode()">
                        Toggle Dev Mode
                    </button>
                </div>
            </div>
        </div>

        <script>
            // Translations
            const translations = {
                en: {
                    save: "Save",
                    saveAs: "Save As",
                    saveDesign: "Export to File",
                    loadDesign: "Load Design",
                    printDesign: "Print Design",
                    clearAll: "Clear All",
                },
                es: {
                    save: "Guardar",
                    saveAs: "Guardar como",
                    saveDesign: "Guardar Diseño",
                    loadDesign: "Cargar Diseño",
                    printDesign: "Imprimir Diseño",
                    clearAll: "Limpiar Todo",
                },
            };

            let currentLang = "es";
            let isDevMode = true;

            // Environment detection (same as designer.html)
            function checkEnvironment() {
                const isProduction =
                    window.location.hostname !== "localhost" &&
                    window.location.hostname !== "127.0.0.1" &&
                    !window.location.hostname.includes("local") &&
                    !window.location.port;

                return {
                    hostname: window.location.hostname,
                    port: window.location.port || "80/443",
                    protocol: window.location.protocol,
                    isProduction: isProduction,
                    environment: isProduction ? "Production" : "Development",
                };
            }

            // Mobile detection
            function checkMobileView() {
                const isMobile = window.innerWidth <= 768;
                return {
                    width: window.innerWidth,
                    height: window.innerHeight,
                    isMobile: isMobile,
                    deviceType: isMobile ? "Mobile" : "Desktop",
                };
            }

            // Initialize environment detection
            function initializeEnvironment() {
                const env = checkEnvironment();
                const isProduction = env.isProduction && !isDevMode;

                const productionOnlyElements =
                    document.querySelectorAll(".production-only");
                productionOnlyElements.forEach((element) => {
                    if (!isProduction) {
                        element.style.display = "none";
                    } else {
                        element.style.display = "";
                    }
                });

                // Update environment display
                document.getElementById("hostname").textContent = env.hostname;
                document.getElementById("port").textContent = env.port;
                document.getElementById("environment").textContent =
                    env.environment;
                document.getElementById("is-production").textContent =
                    isProduction ? "Yes" : "No";

                const envStatus = document.getElementById("environment-status");
                envStatus.textContent = `Environment: ${env.environment} (Production detection: ${isProduction ? "Active" : "Inactive"})`;
                envStatus.className = `status ${isProduction ? "production" : "development"}`;
            }

            // Handle mobile view
            function handleMobileView() {
                const mobile = checkMobileView();
                const isMobile = mobile.isMobile;

                const desktopOnlyElements =
                    document.querySelectorAll(".desktop-only");
                desktopOnlyElements.forEach((element) => {
                    if (isMobile) {
                        element.style.display = "none";
                    } else {
                        element.style.display = "";
                    }
                });

                // Update mobile display
                document.getElementById("window-width").textContent =
                    mobile.width + "px";
                document.getElementById("window-height").textContent =
                    mobile.height + "px";
                document.getElementById("device-type").textContent =
                    mobile.deviceType;
                document.getElementById("is-mobile").textContent = isMobile
                    ? "Yes"
                    : "No";

                const viewportStatus =
                    document.getElementById("viewport-status");
                viewportStatus.textContent = `Viewport: ${mobile.deviceType} (${mobile.width}x${mobile.height})`;
                viewportStatus.className = `status ${isMobile ? "mobile" : "desktop"}`;
            }

            // Update button visibility status
            function updateButtonStatus() {
                const productionButtons =
                    document.querySelectorAll(".production-only");
                const desktopButtons =
                    document.querySelectorAll(".desktop-only");
                const env = checkEnvironment();
                const mobile = checkMobileView();

                let hiddenCount = 0;
                let reasons = [];

                productionButtons.forEach((btn) => {
                    if (btn.style.display === "none") {
                        hiddenCount++;
                        if (!reasons.includes("development"))
                            reasons.push("development environment");
                    }
                });

                desktopButtons.forEach((btn) => {
                    if (btn.style.display === "none") {
                        hiddenCount++;
                        if (!reasons.includes("mobile"))
                            reasons.push("mobile view");
                    }
                });

                const statusDiv = document.getElementById("button-status");
                statusDiv.innerHTML = `
                <div style="margin-top: 10px; padding: 10px; background: #f8f9fa; border-radius: 4px;">
                    <strong>Button Status:</strong><br>
                    • Total buttons: 6<br>
                    • Hidden buttons: ${hiddenCount}<br>
                    • Hidden due to: ${reasons.length > 0 ? reasons.join(", ") : "none"}<br>
                    • Production-only buttons: ${env.isProduction && !isDevMode ? "Visible" : "Hidden"}<br>
                    • Desktop-only buttons: ${!mobile.isMobile ? "Visible" : "Hidden"}
                </div>
            `;
            }

            // Language switching
            function setLanguage(lang) {
                currentLang = lang;
                updateTranslations();
                document.getElementById("current-language").textContent =
                    lang === "en" ? "English" : "Español";
            }

            function updateTranslations() {
                document.querySelectorAll("[data-i18n]").forEach((element) => {
                    const key = element.getAttribute("data-i18n");
                    if (translations[currentLang][key]) {
                        element.textContent = translations[currentLang][key];
                    }
                });
            }

            // Manual test functions
            function refreshTests() {
                initializeEnvironment();
                handleMobileView();
                updateButtonStatus();
                updateTranslations();
            }

            function simulateResize(width, height) {
                // We can't actually resize the window programmatically for security reasons,
                // but we can simulate the effects
                const originalWidth = window.innerWidth;

                // Temporarily override innerWidth for testing
                Object.defineProperty(window, "innerWidth", {
                    writable: true,
                    configurable: true,
                    value: width,
                });

                handleMobileView();
                updateButtonStatus();

                setTimeout(() => {
                    // Restore original width
                    Object.defineProperty(window, "innerWidth", {
                        writable: true,
                        configurable: true,
                        value: originalWidth,
                    });
                }, 100);
            }

            function toggleDevMode() {
                isDevMode = !isDevMode;
                initializeEnvironment();
                updateButtonStatus();

                const btn = event.target;
                btn.textContent = isDevMode
                    ? "Switch to Prod Mode"
                    : "Switch to Dev Mode";
            }

            // Initialize everything
            document.addEventListener("DOMContentLoaded", function () {
                initializeEnvironment();
                handleMobileView();
                updateButtonStatus();
                setLanguage(currentLang);

                // Update on resize
                window.addEventListener("resize", function () {
                    handleMobileView();
                    updateButtonStatus();
                });
            });
        </script>
    </body>
</html>
