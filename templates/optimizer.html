<!doctype html>
<html lang="en">
    <head>
        <meta charset="UTF-8" />
        <meta name="viewport" content="width=device-width, initial-scale=1.0" />
        <title>{{.Title}} - Vitrari</title>

        <!-- Favicon -->
        <link rel="icon" type="image/x-icon" href="/favicon.ico" />
        <link
            rel="icon"
            type="image/svg+xml"
            href="/static/assets/favicon.svg"
        />
        <link
            rel="apple-touch-icon"
            sizes="180x180"
            href="/static/assets/apple-touch-icon.png"
        />

        <link rel="stylesheet" href="/static/css/style.css" />
        <link rel="stylesheet" href="/static/css/mobile.css" />
    </head>
    <body>
        <div class="container">
            <header class="header">
                <div
                    style="
                        display: flex;
                        justify-content: space-between;
                        align-items: center;
                    "
                >
                    <div>
                        <h1>Vitrari</h1>
                        <nav>
                            <a href="/" data-i18n="dashboard">Dashboard</a>
                            <a href="/designer" data-i18n="designer"
                                >Designer</a
                            >
                            <a
                                href="/optimizer"
                                class="active"
                                data-i18n="optimizer"
                                >Optimizer</a
                            >
                        </nav>
                    </div>
                    <div class="language-selector">
                        <button class="lang-btn" data-lang="en">EN</button>
                        <button class="lang-btn active" data-lang="es">
                            ES
                        </button>
                    </div>
                </div>
            </header>

            <main class="optimizer-layout">
                <aside class="sidebar">
                    <h3 data-i18n="selectDesigns">Select Designs</h3>
                    <div id="design-list" class="design-list">
                        <p data-i18n="loadingDesigns">Loading designs...</p>
                    </div>

                    <h3 data-i18n="glassSheet">Glass Sheet</h3>
                    <div id="sheet-list" class="sheet-list">
                        <p data-i18n="loadingSheets">Loading sheets...</p>
                    </div>

                    <h3 data-i18n="algorithm">Algorithm</h3>
                    <select class="full-width" id="algorithm-select">
                        <option value="bottom-left" data-i18n="bottomLeftFill">
                            Bottom-Left Fill
                        </option>
                        <option value="genetic" data-i18n="geneticAlgorithm">
                            Genetic Algorithm
                        </option>
                        <option value="greedy" data-i18n="greedyAlgorithm">
                            Greedy Algorithm
                        </option>
                    </select>
                </aside>

                <div class="optimizer-main">
                    <div class="optimizer-toolbar">
                        <button
                            class="btn btn-primary"
                            onclick="runOptimization()"
                            data-i18n="runOptimization"
                        >
                            Run Optimization
                        </button>
                    </div>

                    <div
                        id="results-area"
                        class="results-area"
                        style="display: none"
                    >
                        <h3 data-i18n="results">Results</h3>
                        <div class="stats-grid">
                            <div class="stat-card">
                                <h4 data-i18n="utilization">Utilization</h4>
                                <div class="stat-value" id="utilization">
                                    0%
                                </div>
                            </div>
                            <div class="stat-card">
                                <h4 data-i18n="waste">Waste</h4>
                                <div class="stat-value" id="waste">0%</div>
                            </div>
                            <div class="stat-card">
                                <h4 data-i18n="piecesPlaced">Pieces Placed</h4>
                                <div class="stat-value" id="pieces">0</div>
                            </div>
                        </div>
                        <div id="visualization" class="visualization">
                            <p data-i18n="visualizationPlaceholder">
                                Visualization will appear here
                            </p>
                        </div>
                    </div>

                    <div class="placeholder-message">
                        <p data-i18n="optimizerInstructions">
                            Select designs and click "Run Optimization" to begin
                        </p>
                    </div>
                </div>
            </main>

            <footer class="footer">
                <p>&copy; 2025 Vitrari - v1.0.0</p>
            </footer>
        </div>

        <script src="/static/js/i18n.js"></script>
        <script src="/static/js/mobile.js"></script>
        <script src="/static/js/app.js"></script>
        <script>
            // Load designs
            fetch("/api/designs")
                .then((r) => r.json())
                .then((data) => {
                    const list = document.getElementById("design-list");
                    list.innerHTML = data.designs
                        .map(
                            (d) =>
                                `<label class="design-item">
                        <input type="checkbox" value="${d.id}">
                        ${d.name} (${d.width}x${d.height}x${d.thickness}mm)
                    </label>`,
                        )
                        .join("");
                });

            // Load sheets
            fetch("/api/sheets")
                .then((r) => r.json())
                .then((data) => {
                    const list = document.getElementById("sheet-list");
                    list.innerHTML = data.sheets
                        .map(
                            (s, i) =>
                                `<label class="sheet-item">
                        <input type="radio" name="sheet" value="${s.id}" ${i === 0 ? "checked" : ""}>
                        ${s.name} (${s.width}x${s.height}mm)
                    </label>`,
                        )
                        .join("");
                });

            function runOptimization() {
                document.querySelector(".placeholder-message").style.display =
                    "none";
                document.getElementById("results-area").style.display = "block";

                fetch("/api/optimize", { method: "POST" })
                    .then((r) => r.json())
                    .then((data) => {
                        const stats = data.optimization.layout.statistics;
                        document.getElementById("utilization").textContent =
                            stats.utilization_rate.toFixed(1) + "%";
                        document.getElementById("waste").textContent =
                            stats.waste_rate.toFixed(1) + "%";
                        document.getElementById("pieces").textContent =
                            stats.placed_pieces;
                    });
            }

            // Update algorithm select options when language changes
            function updateAlgorithmOptions() {
                const select = document.getElementById("algorithm-select");
                const options = select.querySelectorAll("option");
                options.forEach((option) => {
                    const key = option.dataset.i18n;
                    if (key && window.i18n) {
                        option.textContent = window.i18n.t(key);
                    }
                });
            }

            // Listen for language changes
            document.addEventListener("DOMContentLoaded", () => {
                // Initial update
                setTimeout(updateAlgorithmOptions, 100);

                // Listen for language button clicks
                document.querySelectorAll(".lang-btn").forEach((btn) => {
                    btn.addEventListener("click", () => {
                        setTimeout(updateAlgorithmOptions, 100);
                    });
                });
            });
        </script>
    </body>
</html>
